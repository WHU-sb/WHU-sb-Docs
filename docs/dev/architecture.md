# 项目架构

## 🏗️ 系统架构概览

WHU.sb 采用现代化的微服务架构，通过前后端分离和边缘计算实现高性能、高可用的课程评价平台。

## 📊 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户层                                   │
├─────────────────────────────────────────────────────────────────┤
│  Web浏览器  │  移动浏览器  │  PWA应用  │  第三方客户端          │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        CDN/边缘层                               │
├─────────────────────────────────────────────────────────────────┤
│  Cloudflare CDN  │  Cloudflare Workers  │  Cloudflare AI      │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        应用层                                   │
├─────────────────────────────────────────────────────────────────┤
│  前端应用 (Vue 3)  │  后端API (Go)  │  管理后台               │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        服务层                                   │
├─────────────────────────────────────────────────────────────────┤
│  业务服务  │  搜索服务  │  缓存服务  │  AI服务  │  文件服务    │
└─────────────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────────────┐
│                        数据层                                   │
├─────────────────────────────────────────────────────────────────┤
│  MySQL/PostgreSQL  │  Redis  │  Meilisearch  │  Qdrant        │
└─────────────────────────────────────────────────────────────────┘
```

## 🔧 核心组件

### 1. 前端应用 (Frontend)

**技术栈**: Vue 3 + TypeScript + PrimeVue + Vite

**主要功能**:
- 用户界面渲染
- 状态管理 (Pinia)
- 路由管理 (Vue Router)
- 国际化支持 (Vue I18n)
- PWA 功能
- 离线缓存

**架构特点**:
- 组件化设计
- 响应式布局
- 渐进式增强
- 模块化构建

### 2. 后端API服务 (Backend)

**技术栈**: Go + Gin + GORM

**主要功能**:
- RESTful API 服务
- 业务逻辑处理
- 数据访问层
- 权限控制 (RBAC)
- 缓存管理
- 搜索引擎集成

**架构特点**:
- 分层架构 (Handler → Service → Repository)
- 中间件机制
- 依赖注入
- 配置管理

### 3. 边缘计算服务 (Cloudflare Worker)

**技术栈**: TypeScript + Cloudflare Workers

**主要功能**:
- API 网关
- 请求路由
- 响应缓存
- AI 服务集成
- 向量搜索
- 边缘计算

**架构特点**:
- 无服务器架构
- 全球分布式部署
- 低延迟响应
- 自动扩缩容

## 🔄 数据流

### 用户请求流程

1. **用户发起请求**
   - 浏览器/客户端发送 HTTP 请求
   - 请求经过 CDN 加速

2. **边缘处理**
   - Cloudflare Worker 接收请求
   - 进行路由判断和缓存检查
   - 转发到后端服务或直接响应

3. **后端处理**
   - Gin 框架接收请求
   - 中间件处理 (认证、日志、限流)
   - 业务逻辑处理
   - 数据访问和缓存

4. **响应返回**
   - 数据序列化
   - 缓存更新
   - 响应返回给用户

### 数据存储流程

```
用户操作 → 前端验证 → API请求 → 后端验证 → 数据库操作 → 缓存更新 → 响应
```

## 🔐 安全架构

### 认证授权

- **JWT Token**: 无状态认证
- **RBAC**: 基于角色的权限控制
- **API Key**: 第三方服务认证
- **OAuth 2.0**: 第三方登录

### 数据安全

- **HTTPS**: 全站 HTTPS 加密
- **数据加密**: 敏感数据加密存储
- **SQL 注入防护**: 参数化查询
- **XSS 防护**: 输入验证和输出编码
- **CSRF 防护**: Token 验证

### 网络安全

- **CDN 防护**: DDoS 攻击防护
- **WAF**: Web 应用防火墙
- **Rate Limiting**: 请求频率限制
- **IP 白名单**: 管理后台访问控制

## 📈 性能优化

### 前端优化

- **代码分割**: 按需加载
- **资源压缩**: Gzip/Brotli 压缩
- **缓存策略**: 静态资源缓存
- **懒加载**: 图片和组件懒加载
- **PWA**: 离线缓存和后台同步

### 后端优化

- **连接池**: 数据库连接复用
- **缓存策略**: Redis 多级缓存
- **异步处理**: 非阻塞 I/O
- **负载均衡**: 多实例部署
- **数据库优化**: 索引和查询优化

### 边缘优化

- **CDN 加速**: 全球节点分发
- **边缘缓存**: 就近缓存
- **智能路由**: 最优路径选择
- **压缩传输**: 响应数据压缩

## 🔄 部署架构

### 开发环境

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│  前端开发   │    │  后端开发   │    │  Worker开发 │
│  (localhost)│    │  (localhost)│    │  (Wrangler) │
└─────────────┘    └─────────────┘    └─────────────┘
```

### 生产环境

```
┌─────────────────────────────────────────────────────────┐
│                    Cloudflare                           │
├─────────────────────────────────────────────────────────┤
│  CDN  │  Workers  │  D1  │  R2  │  AI  │  Vectorize    │
└─────────────────────────────────────────────────────────┘
                                │
                                ▼
┌─────────────────────────────────────────────────────────┐
│                    应用服务器                            │
├─────────────────────────────────────────────────────────┤
│  负载均衡器  │  前端实例  │  后端实例  │  数据库集群    │
└─────────────────────────────────────────────────────────┘
```

## 🚀 扩展性设计

### 水平扩展

- **无状态设计**: 服务无状态，支持水平扩展
- **负载均衡**: 多实例负载均衡
- **数据库分片**: 数据分片存储
- **缓存集群**: Redis 集群部署

### 垂直扩展

- **微服务拆分**: 按业务域拆分服务
- **模块化设计**: 松耦合架构
- **插件系统**: 可插拔功能模块
- **配置驱动**: 配置化功能开关

## 📊 监控告警

### 应用监控

- **性能监控**: 响应时间、吞吐量
- **错误监控**: 异常捕获和告警
- **业务监控**: 关键业务指标
- **用户行为**: 用户操作分析

### 基础设施监控

- **服务器监控**: CPU、内存、磁盘
- **网络监控**: 带宽、延迟、丢包
- **数据库监控**: 连接数、查询性能
- **缓存监控**: 命中率、内存使用

---

> 💡 **提示**: 架构设计遵循高可用、高性能、易维护的原则，支持业务的快速迭代和扩展。
